==============================================
 –ë–´–°–¢–†–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï - –ö–û–ü–ò–†–£–ô –ò –í–°–¢–ê–í–õ–Ø–ô
==============================================

–°–µ—Ä–≤–µ—Ä: 45.141.78.168
PM2 (–±–µ–∑ Docker)

==============================================
1. –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –°–ï–†–í–ï–†–£
==============================================

ssh root@45.141.78.168


==============================================
2. –°–û–ó–î–ê–ù–ò–ï –î–ò–†–ï–ö–¢–û–†–ò–ò
==============================================

mkdir -p /opt/asian-goods-store
cd /opt/asian-goods-store


==============================================
3. –ö–õ–û–ù–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê (–µ—Å–ª–∏ –µ—Å—Ç—å Git)
==============================================

git clone –í–ê–®_–†–ï–ü–û–ó–ò–¢–û–†–ò–ô .

(–ó–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_–†–ï–ü–û–ó–ò–¢–û–†–ò–ô –Ω–∞ URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)


==============================================
4. –ù–ê–°–¢–†–û–ô–ö–ê BACKEND .ENV
==============================================

nano backend/.env

--- –í–°–¢–ê–í–¨–¢–ï –í –§–ê–ô–õ: ---

PORT=3001
FRONTEND_URL=http://45.141.78.168
JWT_SECRET=–°–ì–ï–ù–ï–†–ò–†–£–ô–¢–ï_–°–õ–£–ß–ê–ô–ù–£–Æ_–°–¢–†–û–ö–£_32_–°–ò–ú–í–û–õ–ê
NODE_ENV=production

# PostgreSQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DB_CLIENT=postgres
PGHOST=localhost
PGPORT=5432
PGDATABASE=magazin
PGUSER=postgres
PGPASSWORD=postgres

--- –°–û–•–†–ê–ù–ò–¢–ï: Ctrl+O, Enter, Ctrl+X ---

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT_SECRET:

node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

(–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ JWT_SECRET)


==============================================
5. –ù–ê–°–¢–†–û–ô–ö–ê FRONTEND .ENV.LOCAL
==============================================

nano .env.local

--- –í–°–¢–ê–í–¨–¢–ï –í –§–ê–ô–õ: ---

NEXT_PUBLIC_API_URL=http://45.141.78.168:3001/api

--- –°–û–•–†–ê–ù–ò–¢–ï: Ctrl+O, Enter, Ctrl+X ---


==============================================
6. –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô
==============================================

npm install
cd backend && npm install && cd ..
npm run build

(–ü–æ–¥–æ–∂–¥–∏—Ç–µ 3-5 –º–∏–Ω—É—Ç)


==============================================
7. –ó–ê–ü–£–°–ö –° PM2
==============================================

mkdir -p logs
pm2 start ecosystem.config.js
pm2 save
pm2 startup

(–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥–ª–æ–∂–∏—Ç PM2, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞:)

pm2 save


==============================================
8. –ü–†–û–í–ï–†–ö–ê
==============================================

pm2 status
curl http://localhost:3001/api/health

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
http://45.141.78.168:3000


==============================================
9. –ù–ê–°–¢–†–û–ô–ö–ê NGINX (—É–±—Ä–∞—Ç—å :3000 –∏–∑ –∞–¥—Ä–µ—Å–∞)
==============================================

apt update
apt install nginx -y
nano /etc/nginx/sites-available/asian-goods

--- –í–°–¢–ê–í–¨–¢–ï –í –§–ê–ô–õ: ---

server {
    listen 80;
    server_name 45.141.78.168;
    client_max_body_size 20M;

    location /api/ {
        proxy_pass http://localhost:3001/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }

    location /uploads/ {
        alias /opt/asian-goods-store/backend/uploads/;
        expires 30d;
    }

    location /_next/ {
        proxy_pass http://localhost:3000/_next/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

--- –°–û–•–†–ê–ù–ò–¢–ï: Ctrl+O, Enter, Ctrl+X ---

–ê–∫—Ç–∏–≤–∞—Ü–∏—è:

ln -s /etc/nginx/sites-available/asian-goods /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
nginx -t
systemctl restart nginx
systemctl enable nginx

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: http://45.141.78.168 (–ë–ï–ó :3000)


==============================================
10. TELEGRAM –ë–û–¢
==============================================

1. Telegram -> @BotFather -> /newbot
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

2. Telegram -> @userinfobot
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Chat ID

3. –û—Ç–∫—Ä–æ–π—Ç–µ: http://45.141.78.168/admin
   –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
   –ù–∞–π–¥–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram"
   –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ Chat ID
   –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
   –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ


==============================================
–ì–û–¢–û–í–û! üéâ
==============================================

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
‚úì –°–∞–π—Ç: http://45.141.78.168
‚úì API: http://45.141.78.168/api/health
‚úì –ê–¥–º–∏–Ω: http://45.141.78.168/admin


==============================================
–ß–ê–°–¢–´–ï –ö–û–ú–ê–ù–î–´
==============================================

–°—Ç–∞—Ç—É—Å:
pm2 status

–õ–æ–≥–∏:
pm2 logs

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:
pm2 restart all

Backup –ë–î:
cd /opt/asian-goods-store/backend/database
cp store.db backup_$(date +%Y%m%d).db

==============================================

